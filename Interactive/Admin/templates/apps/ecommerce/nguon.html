{% extends "partials/base.html" %} {% load static %} {% block title%} Customers
{% endblock title %} {% block extra_css %}
<!-- Sweet Alert css-->
<link
  href="{% static 'libs/sweetalert2/dist/sweetalert2.min.css' %}"
  rel="stylesheet"
  type="text/css"
/>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
{% endblock extra_css %} {% block content %}
<!-- ============================================================== -->
<!-- Start right Content here -->
<!-- ============================================================== -->
<div class="main-content">
  <div class="page-content">
    <div class="container-fluid">
      <div class="row">
        <div class="col-lg-12">
          <div class="card" id="customerList">
            <div class="card-header border-bottom-dashed">
              <div class="row g-4 align-items-center">
                <div class="col-sm">
                  <div>
                    <h5 class="card-title mb-0">Nguồn</h5>
                  </div>
                </div>
                <div class="col-sm-auto">
                  <div>
                    <button
                      type="button"
                      class="btn btn-success add-btn"
                      data-bs-toggle="modal"
                      id="create-btn"
                      data-bs-target="#showModal"
                    >
                      <i class="ri-add-line align-bottom me-1"></i> Thêm nguồn
                      mặc định
                    </button>

                    {% comment %} <button
                      type="button"
                      class="btn btn-success add-btn"
                      data-bs-toggle="modal"
                      id="create-btn-tc"
                      data-bs-target="#showModalTC"
                    >
                      <i class="ri-add-line align-bottom me-1"></i> Thêm nguồn
                      tùy chỉnh
                    </button> {% endcomment %}
                  </div>
                </div>
              </div>
            </div>
            <div class="card-body">
              <div>
                <div class="table-responsive table-card mb-1">
                  <table class="table align-middle" id="customerTable">
                    <thead class="table-light text-muted">
                      <tr>
                        <th class="sort" data-sort="id">#</th>
                        <th class="sort" data-sort="Name_Source">
                          Name Source
                        </th>
                        <th class="sort" data-sort="Link_Id">Link Id</th>
                        <th class="sort" data-sort="Group">Group</th>
                        <th class="sort" data-sort="Type">Type</th>
                        <th class="sort" data-sort="Status">Status</th>
                        <th class="sort" data-sort="action">Action</th>
                      </tr>
                    </thead>
                    <tbody class="list form-check-all">
                      {% for i in track_list %}
                      <tr>
                        <td class="id">{{i.id}}</td>
                        <td class="name">{{i.name}}</td>
                        <td class="keyword">{{i.keyword}}</td>
                        <td class="tag_id">{{i.tag_id.1}}</td>
                        <td class="source_id">{{i.source_id.1}}</td>
                        {% if i.status == False %}
                        <td class="status">
                          <span class="badge badge-soft-danger text-uppercase"
                            >Passive</span
                          >
                        </td>
                        {% else %}
                        <td class="status">
                          <span class="badge badge-soft-success text-uppercase"
                            >Active</span
                          >
                        </td>

                        {% endif %}
                        <td>
                          <ul class="list-inline hstack gap-2 mb-0">
                            <li
                              class="list-inline-item edit"
                              data-bs-toggle="tooltip"
                              data-bs-trigger="hover"
                              data-bs-placement="top"
                              title="Thay đổi trạng thái"
                            >
                              <a
                                href="{% url 'apps:status_c' i.id i.status %}"
                                class="text-primary d-inline-block edit-item-btn"
                              >
                                <i class="ri-pencil-fill fs-16"></i>
                              </a>
                            </li>
                            <li
                              class="list-inline-item"
                              data-bs-toggle="tooltip"
                              data-bs-trigger="hover"
                              data-bs-placement="top"
                              title="Xóa"
                            >
                              <a
                                class="text-danger d-inline-block remove-item-btn"
                                onClick="xoa_nguon({{i.id}})"
                              >
                                <i class="ri-delete-bin-5-fill fs-16"></i>
                              </a>
                            </li>
                          </ul>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                  <div class="noresult" style="display: none">
                    <div class="text-center">
                      <lord-icon
                        src="https://cdn.lordicon.com/msoeawqm.json"
                        trigger="loop"
                        colors="primary:#121331,secondary:#08a88a"
                        style="width: 75px; height: 75px"
                      >
                      </lord-icon>
                      <h5 class="mt-2">Sorry! No Result Found</h5>
                      <p class="text-muted mb-0">
                        We've searched more than 150+ customers We did not find
                        any customers for you search.
                      </p>
                    </div>
                  </div>
                </div>
              </div>
              <div
                class="modal fade"
                id="showModal"
                tabindex="-1"
                aria-hidden="true"
              >
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header bg-light p-3">
                      <h5 class="modal-title" id="exampleModalLabel"></h5>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                        id="close-modal"
                      ></button>
                    </div>
                    <form action="#" method="post">
                      {% csrf_token %}
                      <div class="modal-body">
                        <input type="hidden" id="id-field" />

                        <div class="mb-3">
                          <label for="customername-field" class="form-label"
                            >Tên Nguồn</label
                          >
                          <span>
                            <select
                              name="source_id"
                              class="form-select"
                              aria-label="Default select example"
                              {%
                              ifchanged
                              source_id
                              %}
                              onchange="getListSuggest()"
                              {%
                              endifchanged
                              %}
                            >
                              {% for i in response %}
                              <option value="{{i.id}}">{{i.name}}</option>
                              {% endfor %}
                            </select>
                          </span>
                        </div>

                        <div class="mb-3">
                          <label for="email-field" class="form-label"
                            >Ngành</label
                          >
                          <span>
                            <select
                              name="tag_id"
                              class="form-select"
                              aria-label="Default select example"
                              {%
                              ifchanged
                              tag_id
                              %}
                              onchange="getListSuggest()"
                              {%
                              endifchanged
                              %}
                            >
                              {% for i in tag %}
                              <option value="{{i.id}}">{{i.name}}</option>
                              {% endfor %}
                            </select>
                          </span>
                        </div>

                        <div class="mb-3">
                          <label for="phone-field" class="form-label"
                            >Nguồn</label
                          >
                          <span id="span_listSuggest">
                            <select
                              name="keyword"
                              class="form-select"
                              aria-label="Default select example"
                              id="listSuggest"
                            >
                              {% for i in list_suggest %}
                              <option value="{{i.id_group}}:{{i.name}}">
                                {{i.name}}
                              </option>
                              {% endfor %}
                            </select>
                          </span>
                        </div>

                        <div>
                          <label for="status-field" class="form-label"
                            >Lắng nghe nguồn này</label
                          >
                          <span style="margin-left: 1%">
                            <label class="switch">
                              <input name="status" type="checkbox" checked />
                              <span class="slider round"></span>
                            </label>
                          </span>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <div class="hstack gap-2 justify-content-end">
                          <button
                            type="button"
                            class="btn btn-light"
                            data-bs-dismiss="modal"
                          >
                            Close
                          </button>
                          <button
                            type="submit"
                            class="btn btn-success"
                            id="add-btn"
                          >
                            Add Customer
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

              <div
                class="modal fade"
                id="showModalTC"
                tabindex="-1"
                aria-hidden="true"
              >
                <div class="modal-dialog modal-dialog-centered">
                  <div class="modal-content">
                    <div class="modal-header bg-light p-3">
                      <h5 class="modal-title" id="exampleModalLabel"></h5>
                      <button
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                        id="close-modal"
                      ></button>
                    </div>
                    <form action="#" method="post">
                      {% csrf_token %}
                      <div class="modal-body">
                        <input type="hidden" id="id-field" />

                        <div class="mb-3">
                          <label for="customername-field" class="form-label"
                            >Tên nguồn</label
                          >
                          <span>
                            <input name="name" class="form-control" />
                          </span>
                        </div>

                        <div class="mb-3">
                          <label for="customername-field" class="form-label"
                            >ID Group</label
                          >
                          <span>
                            <input name="keyword" class="form-control" />
                          </span>
                        </div>

                        <div class="mb-3">
                          <label for="customername-field" class="form-label"
                            >ID tài khoản</label
                          >
                          <span>
                            <input name="account_id" class="form-control" />
                          </span>
                        </div>

                        <div>
                          <label for="status-field" class="form-label"
                            >Lắng nghe nguồn này</label
                          >
                          <span style="margin-left: 1%">
                            <label class="switch">
                              <input name="status" type="checkbox" checked />
                              <span class="slider round"></span>
                            </label>
                          </span>
                        </div>
                      </div>
                      <div class="modal-footer">
                        <div class="hstack gap-2 justify-content-end">
                          <button
                            type="button"
                            class="btn btn-light"
                            data-bs-dismiss="modal"
                          >
                            Close
                          </button>
                          <button
                            type="submit"
                            class="btn btn-success"
                            id="add-btn"
                          >
                            Add Customer
                          </button>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>

              <!-- Modal -->
              <div
                class="modal fade zoomIn"
                id="deleteRecordModal"
                tabindex="-1"
                aria-hidden="true"
              >
                <div
                  class="modal-dialog modal-dialog-centered"
                  id="deleteRecordModalCC"
                >
                  <div class="modal-content">
                    <div class="modal-header">
                      <button
                        onClick="Close()"
                        type="button"
                        class="btn-close"
                        data-bs-dismiss="modal"
                        aria-label="Close"
                        id="btn-close"
                      ></button>
                    </div>
                    <div class="modal-body">
                      <div class="mt-2 text-center">
                        <lord-icon
                          src="https://cdn.lordicon.com/gsqxdxog.json"
                          trigger="loop"
                          colors="primary:#f7b84b,secondary:#f06548"
                          style="width: 100px; height: 100px"
                        ></lord-icon>
                        <div class="mt-4 pt-2 fs-15 mx-4 mx-sm-5">
                          <h4>Are you sure ?</h4>
                          <p class="text-muted mx-4 mb-0">
                            Are you sure you want to remove this record ?
                          </p>
                        </div>
                      </div>
                      <div
                        class="d-flex gap-2 justify-content-center mt-4 mb-2"
                      >
                        <button
                          type="button"
                          class="btn w-sm btn-light"
                          data-bs-dismiss="modal"
                          onClick="Close()"
                        >
                          Close
                        </button>
                        <button
                          type="button"
                          class="btn w-sm btn-danger"
                          id="delete_record"
                          onClick="DYXoa()"
                        >
                          Yes, Delete It!
                        </button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!--end modal -->
            </div>
          </div>
        </div>
        <!--end col-->
      </div>
      <!--end row-->
    </div>
    <!-- container-fluid -->
  </div>
  <!-- End Page-content -->
  {% endblock content %} {% block extra_js %}
  <script>
    var id_NgXoa = -1;
    function xoa_nguon(id) {
      document.getElementById("deleteRecordModal").style.display = "inherit";
      document.getElementById("deleteRecordModal").style.opacity = 1;
      document.getElementById("deleteRecordModalCC").style.opacity = 1;
      id_NgXoa = id;
    }

    function Close() {
      document.getElementById("deleteRecordModal").style.display = "none";
      document.getElementById("deleteRecordModal").style.opacity = 0;
      document.getElementById("deleteRecordModalCC").style.opacity = 0;
      id_NgXoa = -1;
    }

    function DYXoa() {
      var data = {
        source_id: id_NgXoa,
      };
      $.ajax({
        url: "/source-clients/delete_source",
        type: "get",
        data: data,
        success: function (data) {
          location.reload();
        },
        error: function (xhr, status, error) {
          console.log(error);
        },
      });
    }

    function getListSuggest() {
      var sourceId = document.getElementsByName("source_id")[0].value;
      var tagId = document.getElementsByName("tag_id")[0].value;
      var data = {
        source_id: sourceId,
        tag_id: tagId,
      };

      $.ajax({
        url: "/source-clients/sourceJs",
        type: "get",
        data: data,
        success: function (data) {
          var selectElement = document.createElement("select");
          for (var i = 0; i < data.list_suggest.length; i++) {
            var option = document.createElement("option");
            option.value =
              data.list_suggest[i].id_group + ":" + data.list_suggest[i].name;
            option.text = data.list_suggest[i].name;
            selectElement.appendChild(option);
          }

          var select = document.getElementById("listSuggest");
          select.parentNode.removeChild(select);
          selectElement.id = "listSuggest";
          selectElement.name = "keyword";
          selectElement.classList = "form-select";
          var span_listSuggest = document.getElementById("span_listSuggest");
          span_listSuggest.appendChild(selectElement);
        },
        error: function (xhr, status, error) {
          console.log(error);
        },
      });
    }
  </script>

  <script src="{% static 'libs/bootstrap/js/bootstrap.bundle.min.js'%}"></script>
  <script src="{% static 'libs/simplebar/simplebar.min.js'%}"></script>
  <script src="{% static 'libs/node-waves/waves.min.js'%}"></script>
  <script src="{% static 'libs/feather-icons/feather.min.js'%}"></script>
  <script src="{% static 'js/pages/plugins/lord-icon-2.1.0.js'%}"></script>
  <script src="{% static 'js/plugins.js'%}"></script>

  <!-- list.js min js -->
  <script src="{% static 'libs/list.js/list.min.js'%}"></script>
  <script src="{% static 'libs/list.pagination.js/list.pagination.min.js'%}"></script>

  <!--ecommerce-customer init js -->
  <script src="{% static 'js/pages/ecommerce-customer-list.init.js'%}"></script>

  <!-- Sweet Alerts js -->
  <script src="{% static 'libs/sweetalert2/sweetalert2.min.js'%}"></script>

  <!-- App js -->
  <script src="{% static 'js/app.js'%}"></script>

  <!-- list.js min js -->
  <script src="{% static 'libs/list.js/dist/list.min.js'%}"></script>
  <script src="{% static 'libs/list.pagination.js/dist/list.pagination.min.js'%}"></script>

  <!--ecommerce-customer init js -->
  <script src="{% static 'js/pages/ecommerce-customer-list.init.js' %}"></script>
  <!-- Sweet Alerts js -->
  <script src="{% static 'libs/sweetalert2/dist/sweetalert2.min.js' %}"></script>
  {% endblock extra_js %}
</div>
